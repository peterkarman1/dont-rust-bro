<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>dont-rust-bro</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: #1a1a2e; color: #e0e0e0; padding: 16px;
    display: flex; flex-direction: column; height: 100vh;
  }
  header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 8px 0; border-bottom: 1px solid #333;
  }
  header h1 { font-size: 16px; font-weight: 600; }
  .badge {
    font-size: 12px; padding: 2px 10px; border-radius: 12px;
    text-transform: capitalize; font-weight: 500;
  }
  .badge.easy { background: #2d6a4f; color: #b7e4c7; }
  .badge.medium { background: #7f5539; color: #ffe0b2; }
  .badge.hard { background: #9b2226; color: #ffccd5; }
  .counter { font-size: 13px; color: #999; }

  .description {
    margin: 12px 0 10px; padding: 10px; border-radius: 6px;
    background: #252545; color: #ccc; font-size: 13px;
    line-height: 1.5; max-height: 120px; overflow-y: auto;
  }
  label { font-size: 12px; font-weight: 600; color: #999; margin-bottom: 4px; display: block; }

  textarea#code {
    flex: 1; width: 100%; padding: 10px; border: 1px solid #333; border-radius: 6px;
    background: #1e1e1e; color: #d4d4d4; font-family: "Menlo", "Consolas", monospace;
    font-size: 13px; resize: none; outline: none; tab-size: 4; min-height: 140px;
  }
  textarea#code:focus { border-color: #555; }

  .output-label { margin-top: 10px; }
  #output {
    width: 100%; padding: 10px; border-radius: 6px; background: #1e1e1e;
    color: #d4d4d4; font-family: "Menlo", "Consolas", monospace; font-size: 12px;
    min-height: 80px; max-height: 140px; overflow-y: auto;
    white-space: pre-wrap; word-wrap: break-word; border: 1px solid #333;
  }
  #output.passed { border-color: #2d6a4f; }
  #output.failed { border-color: #9b2226; }

  .buttons {
    display: flex; gap: 10px; margin-top: 12px; padding-top: 10px;
    border-top: 1px solid #333;
  }
  button {
    padding: 8px 20px; border: none; border-radius: 6px; cursor: pointer;
    font-size: 13px; font-weight: 500; transition: opacity 0.15s;
  }
  button:hover { opacity: 0.85; }
  button:disabled { opacity: 0.5; cursor: not-allowed; }
  .btn-nav { background: #333; color: #e0e0e0; }
  .btn-run { background: #2d6a4f; color: #fff; }
</style>
</head>
<body>
  <header>
    <h1 id="title">Loading...</h1>
    <span id="difficulty" class="badge"></span>
    <span id="counter" class="counter"></span>
  </header>
  <div class="description" id="description"></div>
  <label for="code">Solution:</label>
  <textarea id="code" spellcheck="false"></textarea>
  <label class="output-label">Output:</label>
  <div id="output"></div>
  <div class="buttons">
    <button class="btn-nav" id="prevBtn" onclick="onPrev()">Prev</button>
    <button class="btn-run" id="runBtn" onclick="onRun()">Run</button>
    <button class="btn-nav" id="nextBtn" onclick="onNext()">Next</button>
  </div>

<script>
  let saveTimer = null;

  function populate(data) {
    document.getElementById("title").textContent = data.title;
    const badge = document.getElementById("difficulty");
    badge.textContent = data.difficulty;
    badge.className = "badge " + data.difficulty;
    document.getElementById("counter").textContent = data.counter;
    document.getElementById("description").textContent = data.description;
    document.getElementById("code").value = data.code;
    const out = document.getElementById("output");
    out.textContent = "";
    out.className = "";
  }

  async function onPrev() {
    if (!confirm("Switching problems will erase your progress on the current one. Continue?")) return;
    const data = await window.pywebview.api.prev_problem();
    populate(data);
  }

  async function onNext() {
    if (!confirm("Switching problems will erase your progress on the current one. Continue?")) return;
    const data = await window.pywebview.api.next_problem();
    populate(data);
  }

  async function onRun() {
    const btn = document.getElementById("runBtn");
    btn.disabled = true;
    btn.textContent = "Running...";
    document.getElementById("output").textContent = "Running...";
    const code = document.getElementById("code").value;
    try {
      const result = await window.pywebview.api.run_tests(code);
      const el = document.getElementById("output");
      const status = result.passed ? "PASSED" : "FAILED";
      const output = result.output || "(no output)";
      el.textContent = status + "\n\n" + output;
      el.className = result.passed ? "passed" : "failed";
    } catch (e) {
      document.getElementById("output").textContent = "Error: " + e;
    }
    btn.disabled = false;
    btn.textContent = "Run";
  }

  function onCodeInput() {
    if (saveTimer) clearTimeout(saveTimer);
    saveTimer = setTimeout(async () => {
      const code = document.getElementById("code").value;
      await window.pywebview.api.save_code(code);
    }, 1000);
  }

  // Tab key support in code editor
  document.addEventListener("DOMContentLoaded", () => {
    const editor = document.getElementById("code");
    editor.addEventListener("input", onCodeInput);
    editor.addEventListener("keydown", (e) => {
      if (e.key === "Tab") {
        e.preventDefault();
        const start = editor.selectionStart;
        const end = editor.selectionEnd;
        editor.value = editor.value.substring(0, start) + "    " + editor.value.substring(end);
        editor.selectionStart = editor.selectionEnd = start + 4;
        onCodeInput();
      }
    });
  });

  window.addEventListener("pywebviewready", async () => {
    const data = await window.pywebview.api.get_problem();
    populate(data);
  });
</script>
</body>
</html>
