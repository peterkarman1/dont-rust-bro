#!/usr/bin/env bash
# dont-rust-bro CLI entry point
set -euo pipefail

# Resolve symlinks to find the real install location
SOURCE="${BASH_SOURCE[0]}"
while [ -L "$SOURCE" ]; do
    DIR="$(cd "$(dirname "$SOURCE")" && pwd)"
    SOURCE="$(readlink "$SOURCE")"
    [[ "$SOURCE" != /* ]] && SOURCE="$DIR/$SOURCE"
done
SCRIPT_DIR="$(cd "$(dirname "$SOURCE")" && pwd)"
DRB_ROOT="$(dirname "$SCRIPT_DIR")"

# Use the bundled venv python (handle both Unix and Windows/MSYS paths)
if [ -f "${DRB_ROOT}/venv/Scripts/python.exe" ]; then
    PYTHON="${DRB_ROOT}/venv/Scripts/python.exe"
else
    PYTHON="${DRB_ROOT}/venv/bin/python"
fi

export PYTHONPATH="${DRB_ROOT}${PYTHONPATH:+:$PYTHONPATH}"
exec "$PYTHON" -m drb.cli "$@"
